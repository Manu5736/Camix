<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Camix - Tienda</title>
  <link rel="stylesheet" href="tienda.css" />
</head>
<body>
  <h1>Camix - Tienda</h1>

  <!-- ================== INICIO ================== -->
  <section id="inicio">
    <h2>Registrar Tienda</h2>
    <input id="tiendaNombre" placeholder="Nombre de la tienda" />
    <input id="tiendaCorreo" placeholder="Correo" />
    <input id="tiendaTelefono" placeholder="Tel√©fono" />
    <input id="tiendaDireccion" placeholder="Direcci√≥n" />
    <input id="tiendaPass" placeholder="Contrase√±a (m√≠nimo 8)" type="password" />
    <input id="tiendaAdmin" placeholder="Nombre del Admin responsable" />
    <button onclick="registrarTienda()">Registrar Tienda</button>

    <h2>Iniciar Sesi√≥n Tienda</h2>
    <input id="loginCorreo" placeholder="Correo" />
    <input id="loginPass" placeholder="Contrase√±a" type="password" />
    <button onclick="loginTienda()">Iniciar Sesi√≥n</button>
  </section>

  <!-- ================== PANEL TIENDA ================== -->
  <section id="panelTienda" style="display:none;">
    <h2>Crear Pedido</h2>
    <input id="pedidoCliente" placeholder="Nombre del cliente" />
    <input id="pedidoDireccion" placeholder="Direcci√≥n" />
    <input id="pedidoTelefono" placeholder="Tel√©fono" />
    <select id="pedidoPago">
      <option value="Efectivo">Efectivo</option>
      <option value="Otro">Otro</option>
    </select>
    <input id="pedidoValor" placeholder="Valor del Pedido" type="number" />
    <input id="pedidoDomi" placeholder="Valor del Domicilio" type="number" />
    <button onclick="crearPedido()">Crear Pedido</button>

    <h2>Pedidos Activos</h2>
    <ul id="listaPedidosActivos"></ul>

    <h2>Historial</h2>
    <ul id="listaHistorial"></ul>

    <button onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
  </section>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script src="tienda.js"></script>
</body>
</html><style>body {
  font-family: Arial, sans-serif;
  background: #f8f8f8;
  text-align: center;
  padding: 20px;
}

section {
  margin: 20px auto;
  padding: 20px;
  max-width: 600px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px #ccc;
}

input, select, button {
  margin: 5px;
  padding: 10px;
  width: 80%;
  max-width: 400px;
}

button {
  background: #28a745;
  border: none;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background: #218838;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  text-align: left;
  margin: 5px 0;
  padding: 10px;
  background: #f2f2f2;
  border-radius: 5px;
}</style><script>// Config Firebase
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE_BUCKET",
  messagingSenderId: "TU_MSG_ID",
  appId: "TU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Registrar Tienda
function registrarTienda() {
  const nombre = document.getElementById('tiendaNombre').value;
  const correo = document.getElementById('tiendaCorreo').value;
  const telefono = document.getElementById('tiendaTelefono').value;
  const direccion = document.getElementById('tiendaDireccion').value;
  const pass = document.getElementById('tiendaPass').value;
  const admin = document.getElementById('tiendaAdmin').value;

  if (pass.length < 8) {
    alert("Contrase√±a debe tener m√≠nimo 8 caracteres");
    return;
  }

  db.collection('admins').where('nombre', '==', admin).get().then(snapshot => {
    if (snapshot.empty) {
      alert("Admin no encontrado. Contacta soporte.");
    } else {
      auth.createUserWithEmailAndPassword(correo, pass).then(user => {
        return db.collection('tiendas').doc(user.user.uid).set({
          nombre, correo, telefono, direccion, admin, estado: "activo"
        });
      }).then(() => {
        alert("Tienda registrada correctamente");
      }).catch(err => alert(err.message));
    }
  });
}

// Login Tienda
function loginTienda() {
  const correo = document.getElementById('loginCorreo').value;
  const pass = document.getElementById('loginPass').value;

  auth.signInWithEmailAndPassword(correo, pass)
    .then((cred) => {
      return db.collection('tiendas').doc(cred.user.uid).get();
    })
    .then((doc) => {
      if (doc.exists && doc.data().estado === "bloqueado") {
        alert("üö´ Cuenta bloqueada.\nComun√≠cate con soporte.");
        auth.signOut();
      } else {
        document.getElementById('inicio').style.display = 'none';
        document.getElementById('panelTienda').style.display = 'block';
        cargarPedidosActivos();
        cargarHistorial();
      }
    })
    .catch(err => alert(err.message));
}

// Crear Pedido
function crearPedido() {
  const cliente = document.getElementById('pedidoCliente').value;
  const direccion = document.getElementById('pedidoDireccion').value;
  const telefono = document.getElementById('pedidoTelefono').value;
  const pago = document.getElementById('pedidoPago').value;
  const valor = parseInt(document.getElementById('pedidoValor').value);
  const domi = parseInt(document.getElementById('pedidoDomi').value);
  const userId = auth.currentUser.uid;

  const orden = "CAMIX-" + Math.floor(Math.random() * 10000);

  db.collection('pedidos').add({
    orden,
    cliente,
    direccion,
    telefono,
    metodoPago: pago,
    valorPedido: valor,
    valorDomiciliario: domi,
    pendientePago: pago === "Efectivo",
    estado: "Disponible",
    tiendaId: userId
  }).then(() => {
    alert(`‚úî Pedido ${orden} creado`);
    document.getElementById('pedidoCliente').value = "";
    document.getElementById('pedidoDireccion').value = "";
    document.getElementById('pedidoTelefono').value = "";
    document.getElementById('pedidoValor').value = "";
    document.getElementById('pedidoDomi').value = "";
    cargarPedidosActivos();
  });
}

// Cargar Pedidos Activos
function cargarPedidosActivos() {
  const userId = auth.currentUser.uid;
  db.collection('pedidos').where('tiendaId', '==', userId)
    .where('estado', 'in', ['Disponible', 'Asignado', 'Entregado'])
    .get().then(snapshot => {
      const lista = document.getElementById('listaPedidosActivos');
      lista.innerHTML = "";
      snapshot.forEach(doc => {
        const p = doc.data();
        const total = p.valorPedido + p.valorDomiciliario;
        const li = document.createElement('li');
        li.textContent = `#${p.orden} | $${p.valorPedido} + $${p.valorDomiciliario} = $${total} | Estado: ${p.estado}`;
        lista.appendChild(li);
      });
    });
}

// Cargar Historial
function cargarHistorial() {
  const userId = auth.currentUser.uid;
  db.collection('pedidos').where('tiendaId', '==', userId)
    .where('estado', 'in', ['Entregado', 'Cancelado'])
    .get().then(snapshot => {
      const lista = document.getElementById('listaHistorial');
      lista.innerHTML = "";
      snapshot.forEach(doc => {
        const p = doc.data();
        const li = document.createElement('li');
        li.textContent = `#${p.orden}`;
        li.onclick = () => {
          alert(`#${p.orden}\nCliente: ${p.cliente}\nDir: ${p.direccion}\nPago: ${p.metodoPago}\nPedido: $${p.valorPedido}\nDomi: $${p.valorDomiciliario}\nTOTAL: $${p.valorPedido + p.valorDomiciliario}\nEstado: ${p.estado}\nPendiente Pago: ${p.pendientePago}\nPendiente Devoluci√≥n: ${p.pendienteDevolucion}`);
        };
        lista.appendChild(li);
      });
    });
}

// Cerrar sesi√≥n
function cerrarSesion() {
  auth.signOut().then(() => {
    document.getElementById('panelTienda').style.display = 'none';
    document.getElementById('inicio').style.display = 'block';
  });
}</script>